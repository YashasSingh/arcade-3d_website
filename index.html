<!DOCTYPE html>
<html>
<head>
  <title>Grass Plot with Archery Game</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    #scoreboard, #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
      font-family: Arial, sans-serif;
    }
    #timer {
      top: 60px;
    }
    #arrows-visual {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    .arrow-icon {
      width: 20px;
      height: 60px;
      background: brown;
      border-radius: 2px;
      position: relative;
    }
    .arrow-icon:before, .arrow-icon:after {
      content: "";
      position: absolute;
      background: white;
    }
    .arrow-icon:before {
      width: 8px;
      height: 2px;
      top: 5px;
      left: 50%;
      transform: translateX(-50%) rotate(45deg);
    }
    .arrow-icon:after {
      width: 8px;
      height: 2px;
      top: 5px;
      left: 50%;
      transform: translateX(-50%) rotate(-45deg);
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    <p>Score: <span id="score">0</span></p>
    <p>Arrows Remaining: <span id="arrows-remaining">5</span></p>
  </div>
  <div id="timer">
    <p>Time Left: <span id="time-left">60</span> seconds</p>
  </div>
  <div id="arrows-visual">
    <div class="arrow-icon"></div>
    <div class="arrow-icon"></div>
    <div class="arrow-icon"></div>
    <div class="arrow-icon"></div>
    <div class="arrow-icon"></div>
  </div>
  <a-scene physics="gravity: 0 -9.8 0" shadow="type: pcfsoft">
    <!-- Lights -->
    <a-light type="directional" position="0 10 0" intensity="0.8" castShadow="true" shadow-mapWidth="2048" shadow-mapHeight="2048"></a-light>
    <a-light type="ambient" color="#ffffff" intensity="0.4"></a-light>

    <!-- Grass Plot -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="80" material="color: #7BC8A4; repeat: 20 20" static-body shadow="receive: true"></a-plane>

    <!-- Gravel Path -->
    <a-plane position="0 0.01 0" rotation="-90 0 0" width="5" height="80" material="color: #A9A9A9; repeat: 2 20" static-body shadow="receive: true"></a-plane>
    
    <!-- Archery Target -->
    <a-cylinder id="target-white" position="0 1 -10" rotation="90 0 0" radius="1.5" height="0.001" color="white" static-body shadow="cast: true"></a-cylinder> 
    <a-cylinder id="target-red" position="0 1 -9.99" rotation="90 0 0" radius="1.1" height="0.001" color="red" static-body shadow="cast: true"></a-cylinder>
    <a-cylinder id="target-blue" position="0 1 -9.98" rotation="90 0 0" radius="0.6" height="0.001" color="blue" static-body shadow="cast: true"></a-cylinder>
    <a-cylinder id="target-yellow" position="0 1 -9.97" rotation="90 0 0" radius="0.3" height="0.001" color="yellow" static-body shadow="cast: true"></a-cylinder>

    <!-- Rocks -->
    <a-entity id="rocks"></a-entity>

    <!-- Fence -->
    <a-entity position="-10 0 0">
      <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 80" material="color: brown" position="0 0.5 0" static-body shadow="cast: true"></a-entity>
      <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 80" material="color: brown" position="20 0.5 0" static-body shadow="cast: true"></a-entity>
      <a-entity geometry="primitive: box; width: 0.2; height: 20; depth: 1" material="color: brown" position="10 0.5 -40" rotation="90 0 90" static-body shadow="cast: true"></a-entity>
      <a-entity geometry="primitive: box; width: 0.2; height: 20; depth: 1" material="color: brown" position="10 0.5 40" rotation="90 0 90" static-body shadow="cast: true"></a-entity>
    </a-entity>

    <!-- Sky -->
    <a-sky color="#87CEEB"></a-sky>

    <!-- Camera -->
    <a-entity id="camera" camera position="0 1.6 5" wasd-controls="acceleration: 25" look-controls="pointerLockEnabled: true">
      <a-cursor color="#FF0000"></a-cursor>
      <!-- Crosshair -->
      <a-entity position="0 0 -1">
        <a-ring geometry="primitive: ring; radius-inner: 0.04; radius-outer: 0.05" material="color: red; shader: flat"></a-ring>
        <a-entity geometry="primitive: plane; height: 0.01; width: 0.1" material="color: red; shader: flat" position="0 0 0"></a-entity>
        <a-entity geometry="primitive: plane; height: 0.1; width: 0.01" material="color: red; shader: flat" position="0 0 0"></a-entity>
      </a-entity>
      
      <!-- Arrows -->
      <a-entity id="arrows" position="0 0 -1"></a-entity>
    </a-entity>
    
    <!-- Shooting Mechanism -->
    <a-entity id="shooting-controller" position="0 1.6 4.5"></a-entity>

    <!-- Power-ups -->
    <a-sphere id="power-up" position="5 1 -5" radius="0.5" color="yellow" dynamic-body shadow="cast: true"></a-sphere>

    <!-- Obstacles -->
    <a-box id="obstacle" position="0 1 -5" depth="0.2" height="2" width="2" color="gray" dynamic-body shadow="cast: true"></a-box>

    <!-- Arrow Refill -->
    <a-box id="arrow-refill" position="0 1 0" depth="0.5" height="0.5" width="0.5" color="blue" dynamic-body shadow="cast: true"></a-box>

    <!-- Background Music -->
    <a-assets>
      <audio id="background-music" src="background.mp3" autoplay loop></audio>
      <audio id="shoot-sound" src="shoot.mp3"></audio>
      <audio id="hit-sound" src="hit.mp3"></audio>
      <audio id="reload-sound" src="reload.mp3"></audio>
      <audio id="power-up-sound" src="powerup.mp3"></audio>
    </a-assets>
    <a-sound src="#background-music" autoplay="true" loop="true"></a-sound>
  
    <script>
      var score = 0;
      var arrowsRemaining = 5;
      var timeLeft = 60;
      var scoreMultiplier = 1;
      var refillCollected = false;
  
      function updateScore(points) {
        score += points * scoreMultiplier;
        document.getElementById('score').innerText = score;
        console.log('Score updated:', score);
      }
  
      function updateArrowsRemaining() {
        document.getElementById('arrows-remaining').innerText = arrowsRemaining;
        var arrowsVisual = document.getElementById('arrows-visual');
        arrowsVisual.innerHTML = '';
        for (var i = 0; i < arrowsRemaining; i++) {
          var arrowIcon = document.createElement('div');
          arrowIcon.classList.add('arrow-icon');
          arrowsVisual.appendChild(arrowIcon);
        }
      }
  
      function updateTimeLeft() {
        document.getElementById('time-left').innerText = timeLeft;
      }
  
      function moveTarget() {
        var newPosition = { x: (Math.random() - 0.5) * 20, z: (Math.random() - 0.5) * 80 };
        document.querySelector('#target-white').setAttribute('position', { x: newPosition.x, y: 1, z: newPosition.z });
        document.querySelector('#target-red').setAttribute('position', { x: newPosition.x, y: 1, z: newPosition.z + 0.01 });
        document.querySelector('#target-blue').setAttribute('position', { x: newPosition.x, y: 1, z: newPosition.z + 0.02 });
        document.querySelector('#target-yellow').setAttribute('position', { x: newPosition.x, y: 1, z: newPosition.z + 0.03 });
        console.log('Target moved to:', newPosition);
      }
  
      document.addEventListener('keydown', function(event) {
        if (event.key === ' ' && arrowsRemaining > 0) {
          arrowsRemaining--;
          updateArrowsRemaining();
          var arrow = document.createElement('a-entity');
          arrow.setAttribute('geometry', {
            primitive: 'cylinder',
            radius: 0.02,
            height: 0.5
          });
          arrow.setAttribute('material', 'color', 'brown');
          arrow.setAttribute('position', '0 0 0');
          arrow.setAttribute('rotation', '-90 0 0');
          arrow.setAttribute('velocity', '0 0 -10');
          arrow.setAttribute('dynamic-body', 'shape: cylinder; mass: 0.1');
          arrow.setAttribute('shadow', 'cast', true);
          document.querySelector('#arrows').appendChild(arrow);
  
          // Play shoot sound
          var shootSound = document.querySelector('#shoot-sound');
          shootSound.play();
  
          // Check for hits
          arrow.addEventListener('collide', function(event) {
            var targetId = event.detail.body.el.id;
            if (targetId === 'target-white') {
              updateScore(10);
            } else if (targetId === 'target-red') {
              updateScore(20);
            } else if (targetId === 'target-blue') {
              updateScore(30);
            } else if (targetId === 'target-yellow') {
              updateScore(50);
            }
            var hitSound = document.querySelector('#hit-sound');
            hitSound.play();
            moveTarget();
          });
        }
  
        if (event.key === 'r' && arrowsRemaining === 0 && refillCollected) {
          arrowsRemaining = 5;
          refillCollected = false;
          updateArrowsRemaining();
          var reloadSound = document.querySelector('#reload-sound');
          reloadSound.play();
        }
      });

      // Timer Countdown
      setInterval(function() {
        if (timeLeft > 0) {
          timeLeft--;
          updateTimeLeft();
        } else {
          alert('Game Over! Your score is: ' + score);
          // Reset the game
          score = 0;
          arrowsRemaining = 5;
          timeLeft = 60;
          scoreMultiplier = 1;
          refillCollected = false;
          updateScore(0);
          updateArrowsRemaining();
          updateTimeLeft();
        }
      }, 1000);

      // Power-up Collision
      document.querySelector('#power-up').addEventListener('collide', function(event) {
        var playerId = event.detail.body.el.id;
        if (playerId === 'camera') {
          scoreMultiplier = 2;
          var powerUpSound = document.querySelector('#power-up-sound');
          powerUpSound.play();
          setTimeout(function() {
            scoreMultiplier = 1;
          }, 10000); // Power-up lasts for 10 seconds
          // Move the power-up to a new position
          var newPosition = { x: (Math.random() - 0.5) * 20, y: 1, z: (Math.random() - 0.5) * 80 };
          document.querySelector('#power-up').setAttribute('position', newPosition);
        }
      });

      // Obstacle Movement
      setInterval(function() {
        var obstacle = document.querySelector('#obstacle');
        var newPos = { x: (Math.random() - 0.5) * 20, y: 1, z: (Math.random() - 0.5) * 80 };
        obstacle.setAttribute('position', newPos);
      }, 3000); // Move obstacle every 3 seconds
  
      // Arrow Refill Movement
      setInterval(function() {
        var arrowRefill = document.querySelector('#arrow-refill');
        var newPos = { x: (Math.random() - 0.5) * 20, y: 1, z: (Math.random() - 0.5) * 80 };
        arrowRefill.setAttribute('position', newPos);
      }, 10000); // Move arrow refill every 10 seconds

      // Arrow Refill Collision
      document.querySelector('#arrow-refill').addEventListener('collide', function(event) {
        var playerId = event.detail.body.el.id;
        if (playerId === 'camera') {
          refillCollected = true;
          alert('Arrow refill collected! Press "R" to reload arrows.');
          var reloadSound = document.querySelector('#reload-sound');
          reloadSound.play();
          // Move the arrow refill to a new position
          var newPosition = { x: (Math.random() - 0.5) * 20, y: 1, z: (Math.random() - 0.5) * 80 };
          document.querySelector('#arrow-refill').setAttribute('position', newPosition);
        }
      });

      updateScore(0);
      updateArrowsRemaining();
      updateTimeLeft();
    </script>
  </a-scene>
</body>
</html>
