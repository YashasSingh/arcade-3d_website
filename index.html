<!DOCTYPE html>
<html>
  <head>
    <title>Grass Plot with Archery Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <a-scene physics="gravity: 0 -9.8 0">
      <!-- Grass Plot -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="80" material="color: #7BC8A4; repeat: 20 20" static-body></a-plane>

      <!-- Gravel Path -->
      <a-plane position="0 0.01 0" rotation="-90 0 0" width="5" height="80" material="color: #A9A9A9; repeat: 2 20" static-body></a-plane>
      
      <!-- Archery Target -->
      <a-cylinder position="0 1 -10" rotation="90 0 0" radius="1.5" height="0.1" color="white" static-body></a-cylinder>
      <a-ring position="0 1 -9.85" rotation="90 0 0" radius-inner="0.8" radius-outer="1.1" color="red" static-body></a-ring>
      <a-ring position="0 1 -9.7" rotation="90 0 0" radius-inner="0.4" radius-outer="0.6" color="blue" static-body></a-ring>
      <a-ring position="0 1 -9.55" rotation="90 0 0" radius-inner="0.1" radius-outer="0.3" color="yellow" static-body></a-ring>

      <!-- Bow -->
      <a-entity id="bow" position="0 1.6 0" rotation="0 0 0" scale="0.5 0.5 0.5" obj-model="obj: url(https://cdn.glitch.com/91f1dcd3-d9e1-4ee1-a4b6-f9796abfd7f2%2Fbow.obj); mtl: url(https://cdn.glitch.com/91f1dcd3-d9e1-4ee1-a4b6-f9796abfd7f2%2Fbow.mtl);" static-body></a-entity>
      
      <!-- Rocks -->
      <a-entity id="rocks"></a-entity>

      <!-- Fence -->
      <a-entity position="-10 0 0">
        <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 80" material="color: brown" position="0 0.5 0" static-body></a-entity>
        <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 80" material="color: brown" position="20 0.5 0" static-body></a-entity>
        <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 20" material="color: brown" position="10 0.5 -40" rotation="0 90 0" static-body></a-entity>
        <a-entity geometry="primitive: box; width: 0.2; height: 1; depth: 20" material="color: brown" position="10 0.5 40" rotation="0 90 0" static-body></a-entity>
      </a-entity>

      <!-- Sky -->
      <a-sky color="#87CEEB"></a-sky>

      <!-- Camera -->
      <a-entity camera position="0 1.6 5" wasd-controls="acceleration: 50" look-controls="pointerLockEnabled: true">
        <a-cursor color="#FF0000"></a-cursor>
        <!-- Crosshair -->
        <a-entity position="0 0 -1">
          <a-ring geometry="primitive: ring; radius-inner: 0.03; radius-outer: 0.05" material="color: red; shader: flat"></a-ring>
          <a-entity geometry="primitive: plane; height: 0.01; width: 0.1" material="color: red; shader: flat" position="0 0 0"></a-entity>
          <a-entity geometry="primitive: plane; height: 0.1; width: 0.01" material="color: red; shader: flat" position="0 0 0"></a-entity>
        </a-entity>
      </a-entity>

      <!-- Arrow -->
      <a-entity id="arrow" geometry="primitive: cylinder; radius: 0.005; height: 0.07" material="color: brown" position="0 1.6 4.5" dynamic-body="shape: cylinder; mass: 0.1"></a-entity>
      
      <!-- Shooting Mechanism -->
      <a-entity id="shooting-controller" position="0 1.6 4.5"></a-entity>
    </a-scene>

    <script>
      document.addEventListener('keydown', function(event) {
        if (event.code === 'Space') {
          // Get the arrow entity
          var arrow = document.querySelector('#arrow');
          
          // Apply an impulse to the arrow to make it shoot forward
          arrow.body.applyImpulse(
            new CANNON.Vec3(0, 0, -10), // Impulse
            new CANNON.Vec3().copy(arrow.getAttribute('position')) // Point of application
          );
        }
      });

      // Listen for collisions
      AFRAME.registerComponent('collider', {
        init: function () {
          var el = this.el;
          el.addEventListener('collide', function (e) {
            // Stop the arrow's movement by setting its velocity to zero
            el.body.velocity.set(0, 0, 0);
            el.body.angularVelocity.set(0, 0, 0);
            // Disable further physics interactions for the arrow
            el.removeAttribute('dynamic-body');
          });
        }
      });

      // Add the collider component to the arrow
      document.querySelector('#arrow').setAttribute('collider', '');

      // Randomly place rocks
      function getRandomPosition() {
        return {
          x: (Math.random() - 0.5) * 20, // Random position between -10 and 10
          z: (Math.random() - 0.5) * 80 // Random position between -40 and 40
        };
      }

      function createRock(position) {
        const rockTypes = ['box', 'cylinder', 'cone', 'dodecahedron', 'tetrahedron'];
        const colors = ['#808080', '#696969', '#778899', '#A9A9A9', '#B0C4DE'];

        const typeIndex = Math.floor(Math.random() * rockTypes.length);
        const colorIndex = Math.floor(Math.random() * colors.length);

        const rock = document.createElement('a-entity');
        rock.setAttribute('geometry', `primitive: ${rockTypes[typeIndex]};`);
        rock.setAttribute('material', `color: ${colors[colorIndex]};`);
        rock.setAttribute('position', `${position.x} 0.1 ${position.z}`);
        rock.setAttribute('static-body', '');

        return rock;
      }

      function placeRocks(numRocks) {
        const rocksContainer = document.querySelector('#rocks');
        for (let i = 0; i < numRocks; i++) {
          const position = getRandomPosition();
          const rock = createRock(position);
          rocksContainer.appendChild(rock);
        }
      }

      placeRocks(20); // Place 20 rocks randomly
    </script>
  </body>
</html>
